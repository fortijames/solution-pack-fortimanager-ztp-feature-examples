[
    {
        "@type": "MetafieldTemplate",
        "orderPriority": 5,
        "name": "Global Settings",
        "description": "High Level Variables for all Devices. \n - Dynamically get the `site_id` from the name in the device record. \n - Set the `system_dns`. ",
        "metafieldTemplate": "{\n  \"site_id\": \"{{record.devname|regex_replace('[^0-9]', '')|int}}\",\n  \"system_dns\": \"8.8.8.8\"\n}",
        "metadataSources": null,
        "zTPProfiles": [
            "\/api\/3\/z_t_p_profiles\/dc5681ea-09c5-43e6-9c53-932edd54a3e4",
            "\/api\/3\/z_t_p_profiles\/0be5a9e5-d3db-4633-9b7a-bcf04b090df5",
            "\/api\/3\/z_t_p_profiles\/fc4818dc-3e74-4a6d-a190-ff5cce4eabd8",
            "\/api\/3\/z_t_p_profiles\/99b838a4-69ff-41d2-862c-94aea967a842",
            "\/api\/3\/z_t_p_profiles\/ccf57f5c-ba87-4938-be1d-51f94f6af4bd",
            "\/api\/3\/z_t_p_profiles\/5a9ba361-7fd9-496a-9f78-76ad16a650eb",
            "\/api\/3\/z_t_p_profiles\/1ec909f6-082e-42e1-8441-e27407a2c56b",
            "\/api\/3\/z_t_p_profiles\/6d5faf07-886a-4cab-9934-983d173c25d4",
            "\/api\/3\/z_t_p_profiles\/8c98bd29-b2a1-473b-aaee-d8dd18ffaa11",
            "\/api\/3\/z_t_p_profiles\/4d4e7dfd-9831-4078-8826-98ed6f63f9b9",
            "\/api\/3\/z_t_p_profiles\/d5c36dd9-935d-4a15-be0c-3588c75910bf",
            "\/api\/3\/z_t_p_profiles\/e5247f4b-18cd-40fa-b163-ea85a5db6a18",
            "\/api\/3\/z_t_p_profiles\/361902c6-274f-427d-b92e-81a9c35d8d4a",
            "\/api\/3\/z_t_p_profiles\/31c8a02d-6c59-4dbe-a42f-22baa95065d0",
            "\/api\/3\/z_t_p_profiles\/0d699edf-bb43-4582-9015-4e51da0bfe00",
            "\/api\/3\/z_t_p_profiles\/53f2f971-ad79-4831-8d5f-bd1120ac47ba",
            "\/api\/3\/z_t_p_profiles\/cc16e60d-15ae-4fbb-8de9-b3aa8d3dcafb",
            "\/api\/3\/z_t_p_profiles\/ded225f0-1c18-4f6e-992a-c47809741e87",
            "\/api\/3\/z_t_p_profiles\/e8f6d0d8-5e9e-4c3a-9470-429c4bc64326"
        ],
        "devices": [
            "\/api\/3\/devices\/0663b22a-c181-4068-a4a2-64ab4fb97a41",
            "\/api\/3\/devices\/3b11acbf-0efb-4374-8387-f0155dc10af4",
            "\/api\/3\/devices\/afa445fd-e55c-4011-92f5-da107276e4f8",
            "\/api\/3\/devices\/0d5194d6-f969-47ed-81e7-0e69fab62890",
            "\/api\/3\/devices\/28802f71-b07b-4ad8-996c-32ffe8306487",
            "\/api\/3\/devices\/14ae26b1-8752-4ac9-87eb-91549e462725",
            "\/api\/3\/devices\/11171b12-0fe1-4e0c-bc69-8500121638e2",
            "\/api\/3\/devices\/4d083c42-fc1a-4375-8aab-871a957b4ca2",
            "\/api\/3\/devices\/02b98588-0518-45b4-84e2-82bc66c196bf",
            "\/api\/3\/devices\/df0480c6-b297-4689-9fa0-4857988fc00c",
            "\/api\/3\/devices\/e24ea614-4ef4-4de2-88a1-799513a00718",
            "\/api\/3\/devices\/6a67e4cd-c808-4481-af97-726c86f128ac",
            "\/api\/3\/devices\/23125f1d-3a36-4d59-9389-430d44014d3a",
            "\/api\/3\/devices\/25d45c75-ec3f-4d47-955b-4f3d5760632d",
            "\/api\/3\/devices\/90579abd-0525-4b1e-afba-1dd0880e5ac5",
            "\/api\/3\/devices\/2da90704-35e8-4e7f-86dd-912e2a876cfb",
            "\/api\/3\/devices\/401cebb7-da04-42de-87de-4092e9f091fa",
            "\/api\/3\/devices\/39217ef7-552b-47cc-bd65-ee802c088a9d",
            "\/api\/3\/devices\/3d6c28ad-e379-41ef-ae2d-6c1d59177255"
        ],
        "scripts": [],
        "uuid": "b7b91ff3-e0a5-4ca8-9e92-0c689ef49c97",
        "createUser": "\/api\/3\/people\/3451141c-bac6-467c-8d72-85e0fab569ce",
        "createDate": 1681917839.017956,
        "modifyUser": "\/api\/3\/people\/3451141c-bac6-467c-8d72-85e0fab569ce",
        "modifyDate": 1720632433.853857,
        "owners": [
            "\/api\/3\/teams\/6e569c09-3bd4-40f1-98b0-cc994464c3c5"
        ],
        "recordTags": [
            "FeatureTest"
        ]
    },
    {
        "@type": "MetafieldTemplate",
        "orderPriority": 8,
        "name": "Toggle Device TEST Hostname",
        "description": "Toggle and device hostname with `-TEST` and put the value into the metafield `hostname`. ",
        "metafieldTemplate": "{%- set meta = {} -%}\n{%- if \"TEST\" in record.devname -%}\n{%- set myhost = record.devname | regex_replace(\"-TEST\",\"\") -%}\n{%- else -%}\n{%- set myhost = record.devname + \"-TEST\" -%}\n{%- endif -%}\n{%- set _do = meta.update({\"hostname\":myhost}) -%}\n{{meta}}",
        "metadataSources": null,
        "zTPProfiles": [
            "\/api\/3\/z_t_p_profiles\/a4d43aac-fb83-417b-9719-f0f4ec894f56"
        ],
        "devices": [
            "\/api\/3\/devices\/1d851bcd-d33c-4202-aee5-e81c42503cb2"
        ],
        "scripts": [],
        "uuid": "f4fcc1fa-0654-4d6d-89d8-3de1d5b1bb1f",
        "createUser": "\/api\/3\/people\/3451141c-bac6-467c-8d72-85e0fab569ce",
        "createDate": 1712856806.529667,
        "modifyUser": "\/api\/3\/people\/3451141c-bac6-467c-8d72-85e0fab569ce",
        "modifyDate": 1712857374.768802,
        "owners": [
            "\/api\/3\/teams\/6e569c09-3bd4-40f1-98b0-cc994464c3c5"
        ],
        "recordTags": [
            "FeatureTest"
        ]
    },
    {
        "@type": "MetafieldTemplate",
        "orderPriority": 10,
        "name": "Site Settings - Custom Playbook for for Loopback IP",
        "description": "- This template triggers two sample custom playbooks for review. You can use the playbooks logs to see how variables could be used.\n- We use   `Return an IP Based on Hostname`  playbook to create `loopback0_ip`.\n- The `ip_table` is updated from the `Return a Table of Addresses` playbook. ",
        "metafieldTemplate": "{\n  \"loopback0_ip\": \"{{ip_table_lookup[0]}}\",\n  \"ip_table\": \"{{ip_table|json_query('[].ip')|join(',')}}\"\n}",
        "metadataSources": "[\n  {\n    \"source_type\": \"playbook\",\n    \"keyname\": \"ip_table\",\n    \"playbook_id\": \"9e6cff1f-0fe3-4c85-bf25-5cb409cea778\",\n    \"argument\": \"\"\n  },\n  {\n    \"source_type\": \"playbook\",\n    \"keyname\": \"ip_table_lookup\",\n    \"playbook_id\": \"1c6e570a-605e-46ac-9125-32f2af1877e7\",\n    \"argument\": \"{{record.devname}}\"\n  }\n]",
        "zTPProfiles": [
            "\/api\/3\/z_t_p_profiles\/1ec909f6-082e-42e1-8441-e27407a2c56b"
        ],
        "devices": [
            "\/api\/3\/devices\/3d6c28ad-e379-41ef-ae2d-6c1d59177255"
        ],
        "scripts": [],
        "uuid": "9ba426cd-205f-4ad2-8da7-347556338062",
        "createUser": "\/api\/3\/people\/3451141c-bac6-467c-8d72-85e0fab569ce",
        "createDate": 1686674237.992029,
        "modifyUser": "\/api\/3\/people\/3451141c-bac6-467c-8d72-85e0fab569ce",
        "modifyDate": 1686687984.149566,
        "owners": [
            "\/api\/3\/teams\/6e569c09-3bd4-40f1-98b0-cc994464c3c5"
        ],
        "recordTags": [
            "FeatureTest"
        ]
    },
    {
        "@type": "MetafieldTemplate",
        "orderPriority": 10,
        "name": "Site Settings - Device Group Based on Platform Series",
        "description": " - Create `Device Groups` based on `series` and `platform`. ",
        "metafieldTemplate": "{%- set platform = record.platform -%}\n{%- set partlist = platform.split(\"-\") -%}\n{%- if partlist[1] in [ \"ARM\" , \"VM\" ] -%}\n  {%- set hw_series = \"none\" -%}\n  {%- set model = partlist[1] -%}\n{%- else -%}\n  {%- set hw_series = partlist[1] | regex_replace('^\\d+','') -%}\n  {%- set model = partlist[1] | regex_replace('[A-Z]+','') | default(\"ukn\") -%}\n{%- endif -%}\n{%- set idx = {} -%}\n{%- set _do = idx.update({\n \"platform\": platform,\n  \"device_groups\": \"Series\"+hw_series+\",Model\"+model\n}) -%}\n{{idx}}",
        "metadataSources": "",
        "zTPProfiles": [
            "\/api\/3\/z_t_p_profiles\/99b838a4-69ff-41d2-862c-94aea967a842"
        ],
        "devices": [
            "\/api\/3\/devices\/25d45c75-ec3f-4d47-955b-4f3d5760632d"
        ],
        "scripts": [],
        "uuid": "445d3ab7-0844-46a2-b620-ee4896cf7026",
        "createUser": "\/api\/3\/people\/3451141c-bac6-467c-8d72-85e0fab569ce",
        "createDate": 1689106735.943867,
        "modifyUser": "\/api\/3\/people\/3451141c-bac6-467c-8d72-85e0fab569ce",
        "modifyDate": 1689108581.919348,
        "owners": [
            "\/api\/3\/teams\/6e569c09-3bd4-40f1-98b0-cc994464c3c5"
        ],
        "recordTags": [
            "FeatureTest"
        ]
    },
    {
        "@type": "MetafieldTemplate",
        "orderPriority": 10,
        "name": "Site Settings - Prompt for Loopback IP",
        "description": " - Create empty `loopback0_ip` field. ",
        "metafieldTemplate": "{\"loopback0_ip\":\"\"}",
        "metadataSources": null,
        "zTPProfiles": [
            "\/api\/3\/z_t_p_profiles\/dc5681ea-09c5-43e6-9c53-932edd54a3e4",
            "\/api\/3\/z_t_p_profiles\/d5c36dd9-935d-4a15-be0c-3588c75910bf"
        ],
        "devices": [
            "\/api\/3\/devices\/3b11acbf-0efb-4374-8387-f0155dc10af4",
            "\/api\/3\/devices\/14ae26b1-8752-4ac9-87eb-91549e462725"
        ],
        "scripts": [],
        "uuid": "26637a92-6bf7-4758-9b93-919f99881592",
        "createUser": "\/api\/3\/people\/3451141c-bac6-467c-8d72-85e0fab569ce",
        "createDate": 1685717187.518174,
        "modifyUser": "\/api\/3\/people\/3451141c-bac6-467c-8d72-85e0fab569ce",
        "modifyDate": 1686259698.46644,
        "owners": [
            "\/api\/3\/teams\/6e569c09-3bd4-40f1-98b0-cc994464c3c5"
        ],
        "recordTags": [
            "FeatureTest"
        ]
    },
    {
        "@type": "MetafieldTemplate",
        "orderPriority": 10,
        "name": "Site Settings - Spreadsheet Metadata - by device name",
        "description": "- This template uses a custom playbook to find ALL spreadsheets of type metadata in file [attachments](\/modules\/attachments) and then attaches to the device(s) if they exist.  ",
        "metafieldTemplate": "{{sheet}}",
        "metadataSources": "[\n  {\n    \"source_type\": \"playbook\",\n    \"keyname\": \"sheet\",\n    \"playbook_id\": \"db2fdd13-a520-4479-a6b4-0019e66342c8\",\n    \"argument\": \"hostname:{{record.devname}}\"\n  }\n]",
        "zTPProfiles": [
            "\/api\/3\/z_t_p_profiles\/5a9ba361-7fd9-496a-9f78-76ad16a650eb",
            "\/api\/3\/z_t_p_profiles\/f8033f6f-54e8-4e62-ad2e-bc6f5688c509"
        ],
        "devices": [
            "\/api\/3\/devices\/2da90704-35e8-4e7f-86dd-912e2a876cfb",
            "\/api\/3\/devices\/401cebb7-da04-42de-87de-4092e9f091fa"
        ],
        "scripts": [],
        "uuid": "47f4c63a-e4ae-48e3-8133-4eefad31c19a",
        "createUser": "\/api\/3\/people\/3451141c-bac6-467c-8d72-85e0fab569ce",
        "createDate": 1688155598.782281,
        "modifyUser": "\/api\/3\/people\/3451141c-bac6-467c-8d72-85e0fab569ce",
        "modifyDate": 1688662516.766381,
        "owners": [
            "\/api\/3\/teams\/6e569c09-3bd4-40f1-98b0-cc994464c3c5"
        ],
        "recordTags": [
            "FeatureTest"
        ]
    },
    {
        "@type": "MetafieldTemplate",
        "orderPriority": 10,
        "name": "Site Settings - Static IP Setting Based on Site ID",
        "description": " - Create `loopback0_ip` from the `site_id`",
        "metafieldTemplate": "{\n  \"loopback0_ip\": \"10.255.255.{{devmeta.site_id}}\"\n}",
        "metadataSources": "",
        "zTPProfiles": [
            "\/api\/3\/z_t_p_profiles\/0be5a9e5-d3db-4633-9b7a-bcf04b090df5"
        ],
        "devices": [
            "\/api\/3\/devices\/0663b22a-c181-4068-a4a2-64ab4fb97a41"
        ],
        "scripts": [],
        "uuid": "a2ad4f14-e0f0-42cf-9ad2-80d78b9f8901",
        "createUser": "\/api\/3\/people\/3451141c-bac6-467c-8d72-85e0fab569ce",
        "createDate": 1686747373.852947,
        "modifyUser": "\/api\/3\/people\/3451141c-bac6-467c-8d72-85e0fab569ce",
        "modifyDate": 1686747436.205791,
        "owners": [
            "\/api\/3\/teams\/6e569c09-3bd4-40f1-98b0-cc994464c3c5"
        ],
        "recordTags": [
            "FeatureTest"
        ]
    },
    {
        "@type": "MetafieldTemplate",
        "orderPriority": 11,
        "name": "Site Settings - VLANS from 10.40.0.0\/12",
        "description": "Assign a `\/24` subnet from `10.48.0.0\/12` using the `site_id` and then create `4` vlans using `\/28` blocks for each site. ",
        "metafieldTemplate": "{\n  \"site_subnet\": \"{{'10.48.0.0\/12' | ipaddr('subnet') | ipsubnet(24,devmeta.site_id|int-1)}}\",\n  \"vlan_count\": \"4\",\n  \"vlan_cidr\": \"28\"\n}",
        "metadataSources": null,
        "zTPProfiles": [
            "\/api\/3\/z_t_p_profiles\/6d5faf07-886a-4cab-9934-983d173c25d4",
            "\/api\/3\/z_t_p_profiles\/4d4e7dfd-9831-4078-8826-98ed6f63f9b9",
            "\/api\/3\/z_t_p_profiles\/8c98bd29-b2a1-473b-aaee-d8dd18ffaa11"
        ],
        "devices": [
            "\/api\/3\/devices\/02b98588-0518-45b4-84e2-82bc66c196bf",
            "\/api\/3\/devices\/6a67e4cd-c808-4481-af97-726c86f128ac"
        ],
        "scripts": [],
        "uuid": "e16ef483-59dd-4ca2-85d4-035779a18065",
        "createUser": "\/api\/3\/people\/3451141c-bac6-467c-8d72-85e0fab569ce",
        "createDate": 1689188855.621063,
        "modifyUser": "\/api\/3\/people\/3451141c-bac6-467c-8d72-85e0fab569ce",
        "modifyDate": 1689255757.597952,
        "owners": [
            "\/api\/3\/teams\/6e569c09-3bd4-40f1-98b0-cc994464c3c5"
        ],
        "recordTags": [
            "FeatureTest"
        ]
    },
    {
        "@type": "MetafieldTemplate",
        "orderPriority": 50,
        "name": "Device Physical Port Count Metadata",
        "description": "Count Physical Ports on the FG and update the Metafields `port_count_phy`.",
        "metafieldTemplate": "{%- set ports = interfaces|json_query( '[?type == `physical`].name' ) -%}\n{%- set md = {} -%}\n{%- set _do = md.update({\n  \"port_count_phy\":ports | length\n}) -%}\n{{md}}",
        "metadataSources": "[\n  {\n    \"source_type\": \"fmg\",\n    \"source\": \"{{record.connector_config}}\",\n    \"keyname\": \"interfaces\",\n    \"location\": \"\/pm\/config\/device\/{{record.devname}}\/global\/system\/interface\"\n  }\n]",
        "zTPProfiles": [
            "\/api\/3\/z_t_p_profiles\/53f2f971-ad79-4831-8d5f-bd1120ac47ba",
            "\/api\/3\/z_t_p_profiles\/cc16e60d-15ae-4fbb-8de9-b3aa8d3dcafb",
            "\/api\/3\/z_t_p_profiles\/ded225f0-1c18-4f6e-992a-c47809741e87",
            "\/api\/3\/z_t_p_profiles\/e8f6d0d8-5e9e-4c3a-9470-429c4bc64326"
        ],
        "devices": [
            "\/api\/3\/devices\/28802f71-b07b-4ad8-996c-32ffe8306487",
            "\/api\/3\/devices\/11171b12-0fe1-4e0c-bc69-8500121638e2",
            "\/api\/3\/devices\/4d083c42-fc1a-4375-8aab-871a957b4ca2",
            "\/api\/3\/devices\/df0480c6-b297-4689-9fa0-4857988fc00c",
            "\/api\/3\/devices\/e24ea614-4ef4-4de2-88a1-799513a00718"
        ],
        "scripts": [],
        "uuid": "dc2f4fb9-105d-4fe3-92f9-741a9527be1e",
        "createUser": "\/api\/3\/people\/3451141c-bac6-467c-8d72-85e0fab569ce",
        "createDate": 1703881925.896532,
        "modifyUser": "\/api\/3\/people\/3451141c-bac6-467c-8d72-85e0fab569ce",
        "modifyDate": 1703883074.360137,
        "owners": [
            "\/api\/3\/teams\/6e569c09-3bd4-40f1-98b0-cc994464c3c5"
        ],
        "recordTags": [
            "FeatureTest"
        ]
    },
    {
        "@type": "MetafieldTemplate",
        "orderPriority": 100,
        "name": "Loopback0 Config Check",
        "description": "Confirm that Loopback0 exists on the FG. ",
        "metafieldTemplate": "{%- set lo0 = interfaces|json_query( '[?name == `lo0`].name' ) -%}\n{%- set lo0_test = \"no\" -%}\n{%- if lo0|length > 0  -%}\n  {%- set lo0_test = \"yes\" -%}\n{%- endif -%}\n{%- set md = {} -%}\n{%- set _do = md.update({\"lo0_exists\":lo0_test}) -%}\n{{md}}",
        "metadataSources": "[\n  {\n    \"source_type\": \"fmg\",\n    \"source\": \"{{record.connector_config}}\",\n    \"keyname\": \"interfaces\",\n    \"location\": \"\/pm\/config\/device\/{{record.devname}}\/global\/system\/interface\"\n  }\n]",
        "zTPProfiles": [
            "\/api\/3\/z_t_p_profiles\/0be5a9e5-d3db-4633-9b7a-bcf04b090df5",
            "\/api\/3\/z_t_p_profiles\/d5c36dd9-935d-4a15-be0c-3588c75910bf"
        ],
        "devices": [
            "\/api\/3\/devices\/0663b22a-c181-4068-a4a2-64ab4fb97a41",
            "\/api\/3\/devices\/3b11acbf-0efb-4374-8387-f0155dc10af4"
        ],
        "scripts": [],
        "uuid": "fea4c527-c0b1-4c73-b06b-9634f89f36ea",
        "createUser": "\/api\/3\/people\/3451141c-bac6-467c-8d72-85e0fab569ce",
        "createDate": 1686171549.12008,
        "modifyUser": "\/api\/3\/people\/3451141c-bac6-467c-8d72-85e0fab569ce",
        "modifyDate": 1686259703.45501,
        "owners": [
            "\/api\/3\/teams\/6e569c09-3bd4-40f1-98b0-cc994464c3c5"
        ],
        "recordTags": [
            "FeatureTest"
        ]
    }
]